#!/bin/sh

if [ -z "$PEPPER_SRCDIR" ]; then
	PEPPER_SRCDIR=".."
fi

# Generate the man page
(cd $PEPPER_SRCDIR/docs; make pepper.1.html &> /dev/null; cat pepper.1.html) > src/documentation/manpage.mdwn
sed -i 's/jonas\.gehring/$FORENAME.$SURENAME/' src/documentation/manpage.mdwn
sed -i 's/<html><head>.*<div class="refnamediv"/<div class="refnamediv"/' src/documentation/manpage.mdwn
sed -i 's/<\/body>//' src/documentation/manpage.mdwn

ikiwiki --setup setup

# Copy static files from pepper's source code directory
cp "$PEPPER_SRCDIR/README" pub/documentation/
rm -rf pub/documentation/api
cp -r "$PEPPER_SRCDIR/luadoc" pub/documentation/api
cp "$PEPPER_SRCDIR/ChangeLog" pub/download/
